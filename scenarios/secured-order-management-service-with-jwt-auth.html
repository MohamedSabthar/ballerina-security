<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Secured Order Management Service with JWT Auth - Ballerina Security</title>
        
        


        <!-- Custom HTML head -->
        


        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        
        
        <link rel="shortcut icon" href="../favicon.png">
        
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        
        <link rel="stylesheet" href="../css/print.css" media="print">
        

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        
        <link rel="stylesheet" href="../fonts/fonts.css">
        

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item affix "><a href="../introduction.html">Introduction</a></li><li class="chapter-item affix "><li class="part-title">Summary</li><li class="chapter-item "><a href="../dashboard.html"><strong aria-hidden="true">1.</strong> Dashboard</a></li><li class="chapter-item "><a href="../bbes.html"><strong aria-hidden="true">2.</strong> Ballerina by Examples</a></li><li class="chapter-item "><a href="../examples.html"><strong aria-hidden="true">3.</strong> Examples</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../examples/http.html"><strong aria-hidden="true">3.1.</strong> HTTP</a></li><li class="chapter-item "><a href="../examples/websocket.html"><strong aria-hidden="true">3.2.</strong> WebSocket</a></li><li class="chapter-item "><a href="../examples/graphql.html"><strong aria-hidden="true">3.3.</strong> GraphQL</a></li><li class="chapter-item "><a href="../examples/grpc.html"><strong aria-hidden="true">3.4.</strong> gRPC</a></li><li class="chapter-item "><a href="../examples/websub.html"><strong aria-hidden="true">3.5.</strong> WebSub</a></li><li class="chapter-item "><a href="../examples/kafka.html"><strong aria-hidden="true">3.6.</strong> Kafka</a></li><li class="chapter-item "><a href="../examples/rabbitmq.html"><strong aria-hidden="true">3.7.</strong> RabbitMQ</a></li><li class="chapter-item "><a href="../examples/nats.html"><strong aria-hidden="true">3.8.</strong> NATS</a></li><li class="chapter-item "><a href="../examples/stan.html"><strong aria-hidden="true">3.9.</strong> STAN</a></li><li class="chapter-item "><a href="../examples/email.html"><strong aria-hidden="true">3.10.</strong> Email</a></li><li class="chapter-item "><a href="../examples/ftp.html"><strong aria-hidden="true">3.11.</strong> FTP</a></li><li class="chapter-item "><a href="../examples/tcp.html"><strong aria-hidden="true">3.12.</strong> TCP</a></li></ol></li><li class="chapter-item expanded "><a href="../scenarios.html"><strong aria-hidden="true">4.</strong> Scenarios</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../scenarios/sts.html"><strong aria-hidden="true">4.1.</strong> STS</a></li><li class="chapter-item "><a href="../scenarios/e-commerce-system.html"><strong aria-hidden="true">4.2.</strong> E-Commerce System</a></li><li class="chapter-item expanded "><a href="../scenarios/secured-order-management-service-with-jwt-auth.html" class="active"><strong aria-hidden="true">4.3.</strong> Secured Order Management Service with JWT Auth</a></li><li class="chapter-item "><a href="../scenarios/secured-order-management-service-with-oauth2.html"><strong aria-hidden="true">4.4.</strong> Secured Order Management Service with OAuth2</a></li></ol></li><li class="chapter-item "><a href="../issues.html"><strong aria-hidden="true">5.</strong> Issues</a></li><li class="chapter-item affix "><li class="part-title">References</li><li class="chapter-item "><a href="../references.html"><strong aria-hidden="true">6.</strong> References</a></li><li class="chapter-item "><a href="../about-me.html"><strong aria-hidden="true">7.</strong> About Me</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">Ballerina Security</h1>

                    <div class="right-buttons">
                        
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                        
                        <a href="https://github.com/ldclakmal/ballerina-security" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        
                        

                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1><a class="header" href="#secured-order-management-service-with-jwt-auth" id="secured-order-management-service-with-jwt-auth">Secured Order Management Service with JWT Auth</a></h1>
<h4><a class="header" href="#important-links" id="important-links">Important Links</a></h4>
<ul>
<li><a href="https://github.com/ballerina-platform/module-ballerina-jwt/tree/master/examples/order-management-service"><strong>Source Code</strong></a></li>
<li><a href="https://medium.com/@ldclakmal/securing-microservices-with-jwt-a16b738b110f"><strong>Blog</strong></a></li>
</ul>
<h2><a class="header" href="#overview" id="overview">Overview</a></h2>
<p>This guide explains how to secure an 'Order Management Service' (RESTful service) with JWT Auth using Ballerina.
The following figure illustrates a high-level design diagram of the complete use case.</p>
<p><img src="./order-management-service-jwt.png" alt="Securing Microservice with JWT" /></p>
<p>The end-user (customer), in this example, Alice and Bob, interacts with the system using the web/mobile app provided.
This web/mobile app acts as a 'Client' on behalf of the user’s actions and calls to the 'API Gateway'. The 'API Gateway'
routes the requests to 'Order Service', which is responsible for processing the order for the customer. The 'Inventory
Service' is called by the 'Order Service' to process the inventory-related operations.</p>
<p><strong>NOTE</strong>: For this guide, since we are discussing the JWT security aspects, we are focussing on the network
interactions once the 'API Gateway' receives a request.</p>
<ul>
<li>The 'API Gateway' intercepts the request from the end-user, extracts the token, and then talks to the 'STS' connected
to validate the token.</li>
<li>After validating the token, the 'STS' issues a new JWT signed by itself. This JWT includes the user details.</li>
<li>The 'API Gateway' passes the new JWT to the 'Order Management Service', and it needs only trust this STS to accept
the token as valid. The 'Order Management Service' validates the signature of the JWT to make sure that it's issued
by the 'STS' it trusts. Apart from the signature validation, the 'Order Management Service' also does the issuer and
audience validation.</li>
<li>The 'Order Service' talks to 'Inventory Service' with mTLS (mutual TLS).</li>
</ul>
<p>In this approach, JWT helps us to achieve two things. First, it helps to pass the end-user context across microservices
in a manner that can’t be forged. Because the claims set of the JWT is signed by the STS, no microservice can change
it's content without invalidating its signature. Also, JWT helps to secure service-to-service communications. One
microservice can access another microservice only if it carries a valid JWT issued by the trusted STS. Any recipient
microservice rejects any request without a valid JWT.</p>
<h2><a class="header" href="#implementation" id="implementation">Implementation</a></h2>
<p><strong>NOTE</strong>: To get started with the implementation we need to have the 'Inventory Service' to be ready. But, since we are
focussing only on the 'Order Service' by this guide, the implementation details of the 'Inventory Service' are not
explained. Refer to <a href="./inventory_service"><code>examples/order-management-service/inventory_service</code></a> for the implementation.</p>
<ul>
<li>
<p>Now, we can get started with the Ballerina service; 'Order Service', which is a RESTful service that serves the
order management requests. We will look at securing multiple resources exposed by 'Order Service' to match with the
different security requirements.</p>
<ul>
<li><strong>Create Order</strong> : Order creation should only be allowed for authenticated users.</li>
<li><strong>Retrieve Order</strong> : Retrieval of the order details should be allowed for all the users.</li>
<li><strong>Update Order</strong> : Updating order details should only be allowed for &quot;admin&quot; users.</li>
<li><strong>Delete Order</strong> : Deletion of the order should only be allowed for &quot;admin&quot; users.</li>
</ul>
</li>
<li>
<p>Authentication is enabled by setting the <code>auth</code> attribute of <code>http:ServiceConfig</code> or <code>http:ResourceConfig</code>. If we
configure the <code>auth</code> attribute of <code>http:ServiceConfig</code> it will be applied to all the resources of the configured HTTP
Service. Also, the security enforcement that is done for the service using the <code>http:ServiceConfig</code> can be overridden
by the <code>http:ResourceConfig</code> annotation for a specific API(s).</p>
</li>
<li>
<p>For this example 'Order Service', we need to configure the <code>auth</code> attribute of all the resources except the &quot;Retrieve
Order&quot; resource, since we need to allow that for all the users.</p>
</li>
<li>
<p>Ballerina uses the concept of 'scope' as the way of expressing authorization. Multiple scopes can be assigned to a
user, and scopes can then be validated while enforcing authorization. To express that a certain service or resource
require a scope, we have used the <code>scopes</code> annotation attribute of the <code>auth</code> annotation attribute.</p>
</li>
<li>
<p>For this example 'Order Service', we need to configure the <code>scope</code> attribute for all the resources except the
&quot;Retrieve Order&quot; resource, since we need to allow that for all the users.</p>
</li>
</ul>
<p><strong>NOTE</strong>: For the simplicity of the article, we use an in-memory map for storing order data, and a 'Mock STS' is used
for validating the JWT signature using JWKs. Refer to <a href="./sts"><code>examples/order-management-service/sts</code></a> for the implementation.</p>
<h2><a class="header" href="#testing" id="testing">Testing</a></h2>
<p>We can run the 'Order Service' that we developed above, in our local environment. To complete the design diagram
illustrated above, we have to run the 'Mock STS', and the 'Inventory Service' first.</p>
<p>Open the terminal and navigate to <a href="./sts"><code>examples/order-management-service/sts</code></a> directory and execute the following command.</p>
<pre><code class="language-shell">$ bal run
</code></pre>
<p>The successful execution of the service should show us the following output.</p>
<pre><code class="language-shell">Compiling source
        jwt/sts:1.0.0

Running executable
</code></pre>
<p>Now, navigate to <a href="./inventory_service"><code>examples/order-management-service/inventory_service</code></a> directory and execute the same command.
The successful execution of the service should show us the following output.</p>
<pre><code class="language-shell">Compiling source
        jwt/inventory_service:1.0.0

Running executable
</code></pre>
<p>Now, navigate to <a href="./order_service"><code>examples/order-management-service/order_service</code></a> directory and execute the same command.
The successful execution of the service should show us the following output.</p>
<pre><code class="language-shell">Compiling source
        jwt/order_service:1.0.0

Running executable
</code></pre>
<p>Now, we can test authentication and authorization checks being enforced on different functions of the 'Order Service'
by sending HTTP requests. For example, we have used the CURL commands to test each operation of the 'Order Service' as
follows.</p>
<h3><a class="header" href="#create-order" id="create-order">Create Order</a></h3>
<h4><a class="header" href="#without-authentication" id="without-authentication">Without authentication</a></h4>
<pre><code class="language-shell">curl -k -v -H &quot;Content-Type: application/json&quot; \
-d '{&quot;id&quot;: &quot;100500&quot;, &quot;name&quot;: &quot;Sample order&quot;, &quot;items&quot;: [{&quot;category&quot;: &quot;electronics&quot;, &quot;code&quot;: &quot;SOWH1000XM4&quot;, &quot;qty&quot;: 2}, {&quot;category&quot;: &quot;books&quot;, &quot;code&quot;: &quot;978-1617295959&quot;, &quot;qty&quot;: 1}]}' \
&quot;https://localhost:9090/order&quot;
</code></pre>
<p>Output:</p>
<pre><code class="language-shell">&lt; HTTP/1.1 401 Unauthorized
&lt; content-length: 0
&lt; server: ballerina
&lt; date: Tue, 24 Aug 2021 06:33:52 +0530
</code></pre>
<h4><a class="header" href="#authenticating-as-the-counter-user-who-has-add_order-permission" id="authenticating-as-the-counter-user-who-has-add_order-permission">Authenticating as the 'counter' user, who has 'add_order' permission</a></h4>
<pre><code class="language-shell">curl -k -v -H &quot;Content-Type: application/json&quot; \
-H &quot;Authorization: Bearer eyJhbGciOiJSUzI1NiIsICJ0eXAiOiJKV1QiLCAia2lkIjoiTlRBeFptTXhORE15WkRnM01UVTFaR00wTXpFek9ESmhaV0k0TkRObFpEVTFPR0ZrTmpGaU1RIn0.eyJpc3MiOiJ3c28yIiwgInN1YiI6ImNvdW50ZXIiLCAiYXVkIjoiYmFsbGVyaW5hIiwgImV4cCI6MTk0NTIzODg5NCwgIm5iZiI6MTYyOTg3ODg5NCwgImlhdCI6MTYyOTg3ODg5NCwgImp0aSI6ImY1YWRlZDUwNTg1YzQ2ZjJiOGNhMjMzZDBjMmEzYzlkIiwgInNjb3BlIjoiYWRkX29yZGVyIn0.FMDL-Y8zMtAW7vBVeEbwf_8ynSKdjAkuEBVJpoGds06Z2cOrL3WPZYswnbUOzULBnOXQJQEnK-P-QmypvqP0NWGpzfoC5QMqg0FhPvxyglP1QNYbrS_5tZFM_7Nn7tBFZxiBq666AzjDyhZ2jc39X9rftV0m8p4yyFdSI4KFiEzQ8eOWVVOIg3ejQ0ruDlSVvwx3lXe03XYmrhQp0m-_KYm-SGV3HTZttbo00A250pVY1QL137WDgeeDtGchOfjvM9G-UL8t3sw1Lyoq4OzblHEJJQOJnfRLM_nFKeULuAtt5k_UwmQRlV-XrgxMk0lu6KvYt1-Sa1HMiS8aIvrwig&quot; \
-d '{&quot;id&quot;: &quot;100500&quot;, &quot;name&quot;: &quot;Sample order&quot;, &quot;items&quot;: [{&quot;category&quot;: &quot;electronics&quot;, &quot;code&quot;: &quot;SOWH1000XM4&quot;, &quot;qty&quot;: 2}, {&quot;category&quot;: &quot;books&quot;, &quot;code&quot;: &quot;978-1617295959&quot;, &quot;qty&quot;: 1}]}' \
&quot;https://localhost:9090/order&quot;
</code></pre>
<p>Output:</p>
<pre><code class="language-shell">&lt; HTTP/1.1 201 Created
&lt; Location: http://localhost:9090/order/100500
&lt; content-type: application/json
&lt; content-length: 36
&lt; server: ballerina
&lt; date: Tue, 24 Aug 2021 06:34:05 +0530

{&quot;status&quot;:&quot;Order '100500' created.&quot;}
</code></pre>
<h3><a class="header" href="#retrieve-order" id="retrieve-order">Retrieve Order</a></h3>
<pre><code class="language-shell">curl -k -v &quot;https://localhost:9090/order/100500&quot;
</code></pre>
<p>Output:</p>
<pre><code class="language-shell">&lt; HTTP/1.1 200 OK
&lt; content-type: application/json
&lt; content-length: 70
&lt; server: ballerina
&lt; date: Tue, 24 Aug 2021 06:34:20 +0530

{&quot;id&quot;:&quot;100500&quot;, &quot;name&quot;:&quot;Sample order&quot;, &quot;items&quot;:[{&quot;category&quot;:&quot;electronics&quot;, &quot;code&quot;:&quot;SOWH1000XM4&quot;, &quot;qty&quot;:2}, {&quot;category&quot;:&quot;books&quot;, &quot;code&quot;:&quot;978-1617295959&quot;, &quot;qty&quot;:1}]}
</code></pre>
<h3><a class="header" href="#update-order" id="update-order">Update Order</a></h3>
<h4><a class="header" href="#without-authentication-1" id="without-authentication-1">Without authentication</a></h4>
<pre><code class="language-shell">curl -k -v -X PUT -H &quot;Content-Type:application/json&quot; \
-d '{&quot;name&quot;: &quot;Updated order&quot;, &quot;items&quot;: [{&quot;category&quot;: &quot;electronics&quot;, &quot;code&quot;: &quot;SOWH1000XM4&quot;, &quot;qty&quot;: 1}]}' \
&quot;https://localhost:9090/order/100500&quot;
</code></pre>
<p>Output:</p>
<pre><code class="language-shell">&lt; HTTP/1.1 401 Unauthorized
&lt; content-length: 0
&lt; server: ballerina
&lt; date: Tue, 24 Aug 2021 06:34:32 +0530
</code></pre>
<h4><a class="header" href="#authenticating-as-counter-user-who-has-add_order-permission" id="authenticating-as-counter-user-who-has-add_order-permission">Authenticating as 'counter' user, who has 'add_order' permission</a></h4>
<pre><code class="language-shell">curl -k -v -X PUT -H &quot;Content-Type:application/json&quot; \
-H &quot;Authorization: Bearer eyJhbGciOiJSUzI1NiIsICJ0eXAiOiJKV1QiLCAia2lkIjoiTlRBeFptTXhORE15WkRnM01UVTFaR00wTXpFek9ESmhaV0k0TkRObFpEVTFPR0ZrTmpGaU1RIn0.eyJpc3MiOiJ3c28yIiwgInN1YiI6ImNvdW50ZXIiLCAiYXVkIjoiYmFsbGVyaW5hIiwgImV4cCI6MTk0NTIzODg5NCwgIm5iZiI6MTYyOTg3ODg5NCwgImlhdCI6MTYyOTg3ODg5NCwgImp0aSI6ImY1YWRlZDUwNTg1YzQ2ZjJiOGNhMjMzZDBjMmEzYzlkIiwgInNjb3BlIjoiYWRkX29yZGVyIn0.FMDL-Y8zMtAW7vBVeEbwf_8ynSKdjAkuEBVJpoGds06Z2cOrL3WPZYswnbUOzULBnOXQJQEnK-P-QmypvqP0NWGpzfoC5QMqg0FhPvxyglP1QNYbrS_5tZFM_7Nn7tBFZxiBq666AzjDyhZ2jc39X9rftV0m8p4yyFdSI4KFiEzQ8eOWVVOIg3ejQ0ruDlSVvwx3lXe03XYmrhQp0m-_KYm-SGV3HTZttbo00A250pVY1QL137WDgeeDtGchOfjvM9G-UL8t3sw1Lyoq4OzblHEJJQOJnfRLM_nFKeULuAtt5k_UwmQRlV-XrgxMk0lu6KvYt1-Sa1HMiS8aIvrwig&quot; \
-d '{&quot;name&quot;: &quot;Updated order&quot;, &quot;items&quot;: [{&quot;category&quot;: &quot;electronics&quot;, &quot;code&quot;: &quot;SOWH1000XM4&quot;, &quot;qty&quot;: 1}]}' \
&quot;https://localhost:9090/order/100500&quot;
</code></pre>
<p>Output:</p>
<pre><code class="language-shell">&lt; HTTP/1.1 403 Forbidden
&lt; content-length: 0
&lt; server: ballerina
&lt; date: Tue, 24 Aug 2021 06:34:55 +0530
</code></pre>
<h4><a class="header" href="#authenticating-as-admin-user-who-has-add_order-update_order-cancel_order-permissions" id="authenticating-as-admin-user-who-has-add_order-update_order-cancel_order-permissions">Authenticating as 'admin' user, who has 'add_order, update_order, cancel_order' permissions</a></h4>
<pre><code class="language-shell">curl -k -v -X PUT -H &quot;Content-Type:application/json&quot; \
-H &quot;Authorization: Bearer eyJhbGciOiJSUzI1NiIsICJ0eXAiOiJKV1QiLCAia2lkIjoiTlRBeFptTXhORE15WkRnM01UVTFaR00wTXpFek9ESmhaV0k0TkRObFpEVTFPR0ZrTmpGaU1RIn0.eyJpc3MiOiJ3c28yIiwgInN1YiI6ImFkbWluIiwgImF1ZCI6ImJhbGxlcmluYSIsICJleHAiOjE5NDUyMzY1OTksICJuYmYiOjE2Mjk4NzY1OTksICJpYXQiOjE2Mjk4NzY1OTksICJqdGkiOiJkMWI4NjNlNjc1N2M0ZjJlYjViMjM3YjI5ZmRhOGZhZSIsICJzY29wZSI6WyJhZGRfb3JkZXIiLCAidXBkYXRlX29yZGVyIiwgImNhbmNlbF9vcmRlciJdfQ.XxThNFztJTpn9FIk-9JfEm_xF8sbTwGnNa5bOl-l4lb3KfeV5ojAKEmjenpQR_2YctT2GM68mxunXP4CTxXoAVHAYWDmV10wkR4r7R6LO3wDJDqr7POC3zwtM-n9Ro-gWJEio-SLYw04kxExvjsE1aFa7pRJFuAFDIdAqnXkEaHLXshmOCgxYhAMzdgBQzUtBo7QmjQZf_0kPUioPpNNsDV4bGLQTeZo-SCZhfhvbHBrUsY2VVleUg0_gNVMmT0ySFQ8Jci4CaiglYrxQN9byS38_9qXtWINYEMbtApHaeyl4-0YvY5p8EbJes2ep_r0Q_Od6FQzGekFAVO4gSE6Zw&quot; \
-d '{&quot;name&quot;: &quot;Updated order&quot;, &quot;items&quot;: [{&quot;category&quot;: &quot;electronics&quot;, &quot;code&quot;: &quot;SOWH1000XM4&quot;, &quot;qty&quot;: 1}]}' \
&quot;https://localhost:9090/order/100500&quot;
</code></pre>
<p>Output:</p>
<pre><code class="language-shell">&lt; HTTP/1.1 200 OK
&lt; content-type: application/json
&lt; content-length: 36
&lt; server: ballerina
&lt; date: Tue, 24 Aug 2021 06:35:07 +0530

{&quot;status&quot;:&quot;Order '100500' updated.&quot;}
</code></pre>
<h3><a class="header" href="#cancel-order" id="cancel-order">Cancel Order</a></h3>
<h4><a class="header" href="#authenticating-as-admin-user-who-has-add_order-update_order-cancel_order-permissions-1" id="authenticating-as-admin-user-who-has-add_order-update_order-cancel_order-permissions-1">Authenticating as 'admin' user, who has 'add_order, update_order, cancel_order' permissions</a></h4>
<pre><code class="language-shell">curl -k -v -X DELETE \
-H &quot;Authorization: Bearer eyJhbGciOiJSUzI1NiIsICJ0eXAiOiJKV1QiLCAia2lkIjoiTlRBeFptTXhORE15WkRnM01UVTFaR00wTXpFek9ESmhaV0k0TkRObFpEVTFPR0ZrTmpGaU1RIn0.eyJpc3MiOiJ3c28yIiwgInN1YiI6ImFkbWluIiwgImF1ZCI6ImJhbGxlcmluYSIsICJleHAiOjE5NDUyMzY1OTksICJuYmYiOjE2Mjk4NzY1OTksICJpYXQiOjE2Mjk4NzY1OTksICJqdGkiOiJkMWI4NjNlNjc1N2M0ZjJlYjViMjM3YjI5ZmRhOGZhZSIsICJzY29wZSI6WyJhZGRfb3JkZXIiLCAidXBkYXRlX29yZGVyIiwgImNhbmNlbF9vcmRlciJdfQ.XxThNFztJTpn9FIk-9JfEm_xF8sbTwGnNa5bOl-l4lb3KfeV5ojAKEmjenpQR_2YctT2GM68mxunXP4CTxXoAVHAYWDmV10wkR4r7R6LO3wDJDqr7POC3zwtM-n9Ro-gWJEio-SLYw04kxExvjsE1aFa7pRJFuAFDIdAqnXkEaHLXshmOCgxYhAMzdgBQzUtBo7QmjQZf_0kPUioPpNNsDV4bGLQTeZo-SCZhfhvbHBrUsY2VVleUg0_gNVMmT0ySFQ8Jci4CaiglYrxQN9byS38_9qXtWINYEMbtApHaeyl4-0YvY5p8EbJes2ep_r0Q_Od6FQzGekFAVO4gSE6Zw&quot; \
&quot;https://localhost:9090/order/100500&quot;
</code></pre>
<p>Output:</p>
<pre><code class="language-shell">&lt; HTTP/1.1 200 OK
&lt; content-type: application/json
&lt; content-length: 36
&lt; server: ballerina
&lt; date: Tue, 24 Aug 2021 06:35:26 +0530

{&quot;status&quot;:&quot;Order '100500' removed.&quot;}
</code></pre>
<h2><a class="header" href="#deployment" id="deployment">Deployment</a></h2>
<p>Once we are done with the development, we can deploy the service using any of the methods that are listed below.</p>
<h3><a class="header" href="#deploying-locally" id="deploying-locally">Deploying Locally</a></h3>
<p>As the first step, we can build Ballerina executable files (.jar) of the microservices that we developed above. Open the
terminal and navigate to <a href="./sts"><code>examples/order-management-service/sts</code></a>,
<a href="./inventory_service"><code>examples/order-management-service/inventory_service</code></a>
and <a href="./order_service"><code>examples/order-management-service/order_service</code></a> directories, and execute the following command
for each of them.</p>
<pre><code class="language-shell">$ bal build
</code></pre>
<p>The successful execution of the above command should show us the following outputs in order.</p>
<pre><code class="language-shell">Compiling source
        jwt/sts:1.0.0

Generating executable
        target/bin/sts.jar
</code></pre>
<pre><code class="language-shell">Compiling source
        jwt/inventory_service:1.0.0

Generating executable
        target/bin/inventory_service.jar
</code></pre>
<pre><code class="language-shell">Compiling source
        jwt/order_service:1.0.0

Generating executable
        target/bin/order_service.jar
</code></pre>
<p>Once the <code>*.jar</code> files are created inside the <code>target/bin</code> directories, we can run the microservices with the following
commands in order.</p>
<pre><code class="language-shell">$ bal run target/bin/sts.jar
$ bal run target/bin/inventory_service.jar
$ bal run target/bin/order_service.jar
</code></pre>
<h3><a class="header" href="#deploying-code-to-cloud" id="deploying-code-to-cloud">Deploying Code to Cloud</a></h3>
<p>Ballerina code to cloud supports generating the deployment artifacts of the Docker and Kubernetes.
Refer to <a href="https://ballerina.io/learn/user-guide/deployment/code-to-cloud/">Code to Cloud</a> guide for more information.</p>
<h2><a class="header" href="#observability" id="observability">Observability</a></h2>
<p>HTTP/HTTPS based Ballerina services and any client connectors are observable by default.
<a href="https://ballerina.io/learn/user-guide/observability/observing-ballerina-code/">Observing Ballerina Code</a> guide provides
information on enabling Ballerina service observability with some of its supported systems.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="../scenarios/e-commerce-system.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        
                            <a rel="next" href="../scenarios/secured-order-management-service-with-oauth2.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a rel="prev" href="../scenarios/e-commerce-system.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a rel="next" href="../scenarios/secured-order-management-service-with-oauth2.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                
            </nav>

        </div>

        

        

        

        
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        

        

        
        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        

    </body>
</html>
